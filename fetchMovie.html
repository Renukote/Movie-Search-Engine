<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        #container {
            display: grid;
            grid-gap:40px;
            grid-template-columns: repeat(4, 23%);
            margin:50px auto;
            width: 75%;
        }
        body #container .card {
            border: 1px solid grey;
            height: 300px;
            width: 200px;
        }
        #container img {
            width: 100%;
            height:200px;
        }
        #container h3 {
            height:50px;
        }
        #container h5 {
            margin: 0px;
            padding: 0px;
        }
        #no-results {
            text-align:center;
            width:1000px;
            height:60px;
        }
    </style>
</head>
<body>

    <input type = 'text' id = 'name' placeholder = 'Enter movie name' oninput = 'debounce(main,800)' />
    <div id = 'container'></div>

</body>
</html>


    <script>
        let timerId;
        // 453161dd 

        // making the network request
        async function getData( ) {
            let name = document.getElementById('name');

            let movieList = await fetch(`http://www.omdbapi.com/?apikey=453161dd&tt1285016&s=${name.value}`);
            let data = await movieList.json();

            // console.log( data );
            showMatched( data.Search);
        }

        // displaying the data after fetching. -- done
        function showMatched( data ) 
        {
            let container = document.getElementById("container");
            let name = document.getElementById('name');
            container.innerHTML = "";

            if( data == undefined ) 
            {
                container.innerHTML = '<h1 id = "no-results">No results found</h1>';
            }
            else 
            {
                // looping through each movie and creating a movie box with all details
                data.forEach( async function( item ) {
                try {
                    let div = document.createElement('div');
                    div.class = 'card';
    
                    let img = document.createElement('img');
                    img.src = item.Poster;
        
                    let movieName = document.createElement('h6');
                    movieName.style.fontSize = '10px'
                    movieName.style.margin = '10px 0px';
                    movieName.textContent = item.Title;
    
                    // let type = document.createElement('h4');
                    // type.textContent = item.Type;
    
                    let year = document.createElement('h5');
                    year.style.fontSize = '8px';
                    year.textContent = 'Year - ' + item.Year;
    
                    let ratingDiv = document.createElement('div');
                    let rating = await getRating(item);
    
                    if( rating > 8.5 ) ratingDiv.innerHTML = `<div style = 'display: flex'>
                                                                <div style = 'border:1px solid black; padding:3px; height:10px; border-radius:3px; font-size:8px'>Recommended</div>
                                                                <div style = 'padding:0px; font-weight: 700; font-size:8px'> Rating - ${rating} </div>
                                                              </div>`
    
                    else ratingDiv.innerHTML = `<div style = 'font-size:8px; font-weight:700; padding:5px'>Rating - ${rating}</div>`;
    
                    div.append( img, movieName, year, ratingDiv );
                    container.append(div);
                }
                catch ( error ) { console.log( 'error', error ); }
                });
            }
            
            // getting the movie by imdbID and returning its imdbRating
            async function getRating( id ) {
                let res = await fetch(`http://www.omdbapi.com/?apikey=453161dd&tt1285016&i=${id.imdbID}`);
                let rating = await res.json();

                return rating.imdbRating;
            }
        }
        
        async function main() {
            let name = document.getElementById('name');
            if( name.length <= 3 ) return false;

            getData();
        }

        function debounce(func,delay) {
            if( timerId ) clearTimeout( timerId );

            timerId = setTimeout(function(){ func(); },delay);
        }
    </script>